<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Finals Loadout Randomizer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            background: #d21f3c;
            color: white;
            font-family: Arial, sans-serif;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #ffffff;
            text-transform: uppercase;
            font-size: 2.5rem;
        }

        .section {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .controls {
            text-align: center;
            margin-bottom: 20px;
        }

        .btn {
            background: #ffffff;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 1rem;
            cursor: pointer;
            border-radius: 5px;
            margin: 0 10px;
            text-transform: uppercase;
            font-weight: bold;
        }

        .btn:hover {
            background: #e55a2b;
        }

        .result {
            background: #222;
            border: 2px solid #ffffff;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
        }

        .result h3 {
            color: #ffffff;
            margin-bottom: 10px;
        }

        .url-box {
            background: #111;
            border: 1px solid #444;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            word-break: break-all;
            font-family: monospace;
        }

        .equipment-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .build-box {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 10px;
            padding: 20px;
        }

        .build-title {
            color: #ffffff;
            text-align: center;
            font-size: 1.3rem;
            margin-bottom: 15px;
            text-transform: uppercase;
            border-bottom: 2px solid #333;
            padding-bottom: 10px;
        }

        .category {
            margin-bottom: 15px;
        }

        .category-title {
            color: #ccc;
            font-size: 0.9rem;
            text-transform: uppercase;
            margin-bottom: 10px;
            border-bottom: 1px solid #333;
            padding-bottom: 5px;
        }

        .item {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
            padding: 5px 10px;
            background: #111;
            border-radius: 5px;
        }

        .item:hover {
            background: #222;
        }

        .item input {
            margin-right: 10px;
            transform: scale(1.2);
            accent-color: white;
        }

        .item label {
            cursor: pointer;
            flex: 1;
            color: white;
        }

        .item input:checked + label {
            color: #ffffff;
            font-weight: bold;
        }

        .bulk-controls {
            text-align: center;
            margin-bottom: 20px;
        }

        .bulk-btn {
            background: #333;
            color: white;
            border: 1px solid #555;
            padding: 8px 16px;
            margin: 0 5px;
            cursor: pointer;
            border-radius: 5px;
        }

        .bulk-btn:hover {
            background: #444;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>The Finals Loadout Randomizer</h1>
        
        <div class="section">
            <div class="controls">
                <button class="btn" onclick="generateRandomLoadout()">Generate Random Loadout</button>
                <button class="btn" onclick="generateAllBuilds()">Generate All 3 Builds</button>
            </div>
            
            <div id="results"></div>
        </div>

        <div class="section">
            <div class="bulk-controls">
                <button class="bulk-btn" onclick="selectAll()">Select All</button>
                <button class="bulk-btn" onclick="deselectAll()">Deselect All</button>
            </div>
            
            <div class="equipment-grid" id="equipmentGrid">
                <!-- Equipment toggles will be populated here -->
            </div>
        </div>
    </div>

    <script>
        let gameData = [];

        // Load data from data.json
        async function loadData() {
            try {
                const response = await fetch('data.json');
                gameData = await response.json();
                populateEquipmentToggles();
            } catch (error) {
                console.error('Error loading data:', error);
                alert('Error loading data.json. Please make sure the file exists and is properly formatted.');
            }
        }

        function populateEquipmentToggles() {
            const grid = document.getElementById('equipmentGrid');
            
            gameData.forEach(buildData => {
                const buildDiv = document.createElement('div');
                buildDiv.className = 'build-box';
                
                const buildTitle = document.createElement('div');
                buildTitle.className = 'build-title';
                buildTitle.textContent = buildData.build.name;
                buildDiv.appendChild(buildTitle);

                // Specializations
                if (buildData.specializations.length > 0) {
                    const specDiv = document.createElement('div');
                    specDiv.className = 'category';
                    const specTitle = document.createElement('div');
                    specTitle.className = 'category-title';
                    specTitle.textContent = 'Specializations';
                    specDiv.appendChild(specTitle);

                    buildData.specializations.forEach(spec => {
                        const item = createEquipmentToggle(spec.id, spec.name, true);
                        specDiv.appendChild(item);
                    });
                    buildDiv.appendChild(specDiv);
                }

                // Gadgets
                if (buildData.gadgets.length > 0) {
                    const gadgetDiv = document.createElement('div');
                    gadgetDiv.className = 'category';
                    const gadgetTitle = document.createElement('div');
                    gadgetTitle.className = 'category-title';
                    gadgetTitle.textContent = 'Gadgets';
                    gadgetDiv.appendChild(gadgetTitle);

                    buildData.gadgets.forEach(gadget => {
                        const item = createEquipmentToggle(gadget.id, gadget.name, true);
                        gadgetDiv.appendChild(item);
                    });
                    buildDiv.appendChild(gadgetDiv);
                }

                // Weapons
                if (buildData.weapons.length > 0) {
                    const weaponDiv = document.createElement('div');
                    weaponDiv.className = 'category';
                    const weaponTitle = document.createElement('div');
                    weaponTitle.className = 'category-title';
                    weaponTitle.textContent = 'Weapons';
                    weaponDiv.appendChild(weaponTitle);

                    buildData.weapons.forEach(weapon => {
                        const item = createEquipmentToggle(weapon.id, weapon.name, true);
                        weaponDiv.appendChild(item);
                    });
                    buildDiv.appendChild(weaponDiv);
                }

                grid.appendChild(buildDiv);
            });
        }

        function createEquipmentToggle(id, name, defaultChecked) {
            const item = document.createElement('div');
            item.className = 'item';

            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.id = id;
            checkbox.checked = defaultChecked;

            const label = document.createElement('label');
            label.htmlFor = id;
            label.textContent = name;

            item.appendChild(checkbox);
            item.appendChild(label);

            return item;
        }

        function getAvailableItems(buildData, category) {
            return buildData[category].filter(item => {
                const checkbox = document.getElementById(item.id);
                return checkbox && checkbox.checked;
            });
        }

        function getRandomItem(items) {
            if (items.length === 0) return null;
            return items[Math.floor(Math.random() * items.length)];
        }

        function generateRandomLoadout() {
            const availableBuilds = gameData.filter(buildData => {
                const buildCheckbox = document.getElementById(buildData.build.id);
                return !buildCheckbox || buildCheckbox.checked;
            });

            if (availableBuilds.length === 0) {
                alert('No builds available! Please select at least one build.');
                return;
            }

            const randomBuild = getRandomItem(availableBuilds);
            const loadout = generateLoadoutForBuild(randomBuild);
            
            displayResults([loadout]);
        }

        function generateAllBuilds() {
            const loadouts = [];
            
            gameData.forEach(buildData => {
                const buildCheckbox = document.getElementById(buildData.build.id);
                if (!buildCheckbox || buildCheckbox.checked) {
                    const loadout = generateLoadoutForBuild(buildData);
                    loadouts.push(loadout);
                }
            });

            if (loadouts.length === 0) {
                alert('No builds available! Please select at least one build.');
                return;
            }

            displayResults(loadouts);
        }

        function generateLoadoutForBuild(buildData) {
            const availableSpecs = getAvailableItems(buildData, 'specializations');
            const availableGadgets = getAvailableItems(buildData, 'gadgets');
            const availableWeapons = getAvailableItems(buildData, 'weapons');

            const randomSpec = getRandomItem(availableSpecs);
            const randomGadgets = [];
            const randomWeapon = getRandomItem(availableWeapons);

            // Select 3 random gadgets
            for (let i = 0; i < 3 && availableGadgets.length > 0; i++) {
                const gadget = getRandomItem(availableGadgets);
                if (gadget) {
                    randomGadgets.push(gadget);
                    // Remove selected gadget to avoid duplicates
                    const index = availableGadgets.indexOf(gadget);
                    availableGadgets.splice(index, 1);
                }
            }

            // Generate URL code
            let code = buildData.build.id;
            if (randomSpec) code += randomSpec.id;
            if (randomWeapon) code += randomWeapon.id;
            randomGadgets.forEach(gadget => code += gadget.id);

            // Pad with additional characters if needed (based on the pattern you showed)
            while (code.length < 14) {
                code += 'XX'; // Placeholder
            }

            return {
                build: buildData.build.name,
                specialization: randomSpec ? randomSpec.name : 'None available',
                weapon: randomWeapon ? randomWeapon.name : 'None available',
                gadgets: randomGadgets.map(g => g.name),
                code: code,
                url: `https://www.thefinals.me/-/${code}`
            };
        }

        function displayResults(loadouts) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '';

            loadouts.forEach((loadout, index) => {
                const resultDiv = document.createElement('div');
                resultDiv.className = 'result';

                resultDiv.innerHTML = `
                    <h3>${loadout.build} Build</h3>
                    <p><strong>Specialization:</strong> ${loadout.specialization}</p>
                    <p><strong>Weapon:</strong> ${loadout.weapon}</p>
                    <p><strong>Gadgets:</strong> ${loadout.gadgets.join(', ')}</p>
                    <div class="url-box">
                        <strong>URL:</strong> <a href="${loadout.url}" target="_blank" style="color: white; text-decoration: underline;">${loadout.url}</a>
                    </div>
                `;

                resultsDiv.appendChild(resultDiv);
            });
        }

        function selectAll() {
            const checkboxes = document.querySelectorAll('input[type="checkbox"]');
            checkboxes.forEach(cb => cb.checked = true);
        }

        function deselectAll() {
            const checkboxes = document.querySelectorAll('input[type="checkbox"]');
            checkboxes.forEach(cb => cb.checked = false);
        }

        // Initialize when page loads
        window.addEventListener('load', loadData);
    </script>
</body>
</html>
