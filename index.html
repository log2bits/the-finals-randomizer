<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Finals Equipment Randomizer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            text-transform: uppercase;
        }

        .btn-primary {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(45deg, #74b9ff, #0984e3);
            color: white;
            box-shadow: 0 4px 15px rgba(116, 185, 255, 0.3);
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(116, 185, 255, 0.4);
        }

        .btn-danger {
            background: linear-gradient(45deg, #636e72, #2d3436);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
        }

        .rule-display {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .rule-text {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .rule-stats {
            font-size: 1rem;
            opacity: 0.9;
        }

        .equipment-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .class-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .class-title {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: #ffd700;
            text-transform: uppercase;
        }

        .equipment-category {
            margin-bottom: 15px;
        }

        .category-title {
            font-size: 1rem;
            font-weight: bold;
            margin-bottom: 8px;
            color: #74b9ff;
            text-transform: uppercase;
        }

        .equipment-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .equipment-item {
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .equipment-allowed {
            background: rgba(0, 255, 0, 0.2);
            border: 1px solid rgba(0, 255, 0, 0.4);
            color: #90EE90;
        }

        .equipment-banned {
            background: rgba(255, 0, 0, 0.2);
            border: 1px solid rgba(255, 0, 0, 0.4);
            color: #FFB6C1;
            text-decoration: line-through;
            opacity: 0.7;
        }

        .loading {
            text-align: center;
            font-size: 1.2rem;
            margin: 50px 0;
        }

        .error {
            background: rgba(255, 0, 0, 0.1);
            border: 1px solid rgba(255, 0, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            text-align: center;
        }

        .cache-info {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 0.9rem;
            opacity: 0.8;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            .equipment-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ The Finals Equipment Randomizer</h1>
            <p>Generate simple rules to create unique equipment restrictions for each game!</p>
        </div>

        <div class="controls">
            <button class="btn btn-primary" onclick="generateNewRule()">üé≤ Generate New Rule</button>
            <button class="btn btn-secondary" onclick="toggleView()">üëÅÔ∏è Toggle View</button>
            <button class="btn btn-danger" onclick="resetCache()">üóëÔ∏è Reset Cache</button>
        </div>

        <div class="cache-info" id="cacheInfo">
            Loading...
        </div>

        <div class="rule-display" id="ruleDisplay" style="display: none;">
            <div class="rule-text" id="ruleText">Generate a rule to get started!</div>
            <div class="rule-stats" id="ruleStats"></div>
        </div>

        <div id="equipmentDisplay"></div>
    </div>

    <script>
        let gameData = null;
        let currentRule = null;
        let filteredData = null;
        let showBanned = false;

        // Rule definitions - easy to understand and apply quickly
        const rules = [
            {
                name: "Contains vowel 'A'",
                test: (name) => name.toLowerCase().includes('a'),
                description: "Equipment names containing the letter 'A'"
            },
            {
                name: "Contains vowel 'E'",
                test: (name) => name.toLowerCase().includes('e'),
                description: "Equipment names containing the letter 'E'"
            },
            {
                name: "Contains vowel 'I'",
                test: (name) => name.toLowerCase().includes('i'),
                description: "Equipment names containing the letter 'I'"
            },
            {
                name: "Contains vowel 'O'",
                test: (name) => name.toLowerCase().includes('o'),
                description: "Equipment names containing the letter 'O'"
            },
            {
                name: "Contains vowel 'U'",
                test: (name) => name.toLowerCase().includes('u'),
                description: "Equipment names containing the letter 'U'"
            },
            {
                name: "Contains letter 'R'",
                test: (name) => name.toLowerCase().includes('r'),
                description: "Equipment names containing the letter 'R'"
            },
            {
                name: "Contains letter 'S'",
                test: (name) => name.toLowerCase().includes('s'),
                description: "Equipment names containing the letter 'S'"
            },
            {
                name: "Contains letter 'T'",
                test: (name) => name.toLowerCase().includes('t'),
                description: "Equipment names containing the letter 'T'"
            },
            {
                name: "Contains letter 'N'",
                test: (name) => name.toLowerCase().includes('n'),
                description: "Equipment names containing the letter 'N'"
            },
            {
                name: "Contains letter 'L'",
                test: (name) => name.toLowerCase().includes('l'),
                description: "Equipment names containing the letter 'L'"
            },
            {
                name: "Contains numbers",
                test: (name) => /\d/.test(name),
                description: "Equipment names containing any numbers"
            },
            {
                name: "Contains dash or hyphen",
                test: (name) => name.includes('-'),
                description: "Equipment names containing a dash (-)"
            },
            {
                name: "Contains space",
                test: (name) => name.includes(' '),
                description: "Equipment names containing a space"
            },
            {
                name: "Starts with vowel",
                test: (name) => /^[aeiouAEIOU]/.test(name),
                description: "Equipment names starting with a vowel (A, E, I, O, U)"
            },
            {
                name: "Starts with consonant",
                test: (name) => /^[bcdfghjklmnpqrstvwxyzBCDFGHJKLMNPQRSTVWXYZ]/.test(name),
                description: "Equipment names starting with a consonant"
            },
            {
                name: "Ends with vowel",
                test: (name) => /[aeiouAEIOU]$/.test(name),
                description: "Equipment names ending with a vowel (A, E, I, O, U)"
            },
            {
                name: "Ends with consonant",
                test: (name) => /[bcdfghjklmnpqrstvwxyzBCDFGHJKLMNPQRSTVWXYZ]$/.test(name),
                description: "Equipment names ending with a consonant"
            },
            {
                name: "Single word",
                test: (name) => !name.includes(' ') && !name.includes('-'),
                description: "Equipment names that are a single word (no spaces or dashes)"
            },
            {
                name: "Multiple words",
                test: (name) => name.includes(' ') || name.includes('-'),
                description: "Equipment names with multiple words (contains spaces or dashes)"
            },
            {
                name: "Contains double letters",
                test: (name) => /(.)\1/.test(name.toLowerCase()),
                description: "Equipment names with repeated letters (like 'tt', 'ee', etc.)"
            }
        ];

        // Cache management
        function getUsedRules() {
            const cached = localStorage.getItem('finalsEquipmentRules');
            return cached ? JSON.parse(cached) : [];
        }

        function addUsedRule(ruleName) {
            const usedRules = getUsedRules();
            if (!usedRules.includes(ruleName)) {
                usedRules.push(ruleName);
                localStorage.setItem('finalsEquipmentRules', JSON.stringify(usedRules));
            }
        }

        function resetCache() {
            localStorage.removeItem('finalsEquipmentRules');
            updateCacheInfo();
            alert('Cache reset! All rules are now available again.');
        }

        function updateCacheInfo() {
            const usedRules = getUsedRules();
            const cacheInfo = document.getElementById('cacheInfo');
            cacheInfo.textContent = `Rules used: ${usedRules.length}/${rules.length} | Remaining: ${rules.length - usedRules.length}`;
        }

        // Load game data
        async function loadGameData() {
            try {
                const response = await fetch('https://raw.githubusercontent.com/log2bits/the-finals-randomizer/refs/heads/main/data.json');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                gameData = await response.json();
                updateCacheInfo();
            } catch (error) {
                console.error('Error loading game data:', error);
                document.getElementById('equipmentDisplay').innerHTML = 
                    '<div class="error">Failed to load game data. Please check your internet connection and try again.</div>';
            }
        }

        // Count equipment by category
        function countEquipment(data) {
            let total = 0;
            const counts = { specializations: {}, gadgets: {}, weapons: {} };
            
            data.forEach(buildData => {
                const buildName = buildData.build.name;
                
                counts.specializations[buildName] = buildData.specializations.length;
                counts.gadgets[buildName] = buildData.gadgets.length;
                counts.weapons[buildName] = buildData.weapons.length;
                
                total += buildData.specializations.length + buildData.gadgets.length + buildData.weapons.length;
            });
            
            return { total, counts };
        }

        // Check if rule meets minimum requirements
        function validateRule(rule, data) {
            const filtered = filterData(rule, data);
            const counts = countEquipment(filtered);
            
            // Check minimum requirements
            const minSpecializations = Object.values(counts.counts.specializations).every(count => count >= 1);
            const minGadgets = Object.values(counts.counts.gadgets).every(count => count >= 3);
            const minWeapons = Object.values(counts.counts.weapons).every(count => count >= 1);
            
            return {
                valid: minSpecializations && minGadgets && minWeapons && counts.total >= 25,
                counts: counts,
                issues: {
                    specializations: !minSpecializations,
                    gadgets: !minGadgets,
                    weapons: !minWeapons,
                    total: counts.total < 25
                }
            };
        }

        // Filter data based on rule
        function filterData(rule, data) {
            return data.map(buildData => ({
                ...buildData,
                specializations: buildData.specializations.filter(item => rule.test(item.name)),
                gadgets: buildData.gadgets.filter(item => rule.test(item.name)),
                weapons: buildData.weapons.filter(item => rule.test(item.name))
            }));
        }

        // Generate a new rule
        function generateNewRule() {
            if (!gameData) {
                alert('Game data not loaded yet. Please wait a moment and try again.');
                return;
            }

            const usedRules = getUsedRules();
            const availableRules = rules.filter(rule => !usedRules.includes(rule.name));
            
            if (availableRules.length === 0) {
                alert('All rules have been used! Reset the cache to use rules again.');
                return;
            }

            let attempts = 0;
            let validRule = null;
            
            // Try to find a valid rule (max 50 attempts)
            while (attempts < 50 && !validRule) {
                const randomRule = availableRules[Math.floor(Math.random() * availableRules.length)];
                const validation = validateRule(randomRule, gameData);
                
                if (validation.valid) {
                    validRule = randomRule;
                } else {
                    // Remove invalid rule from available rules for this session
                    const index = availableRules.indexOf(randomRule);
                    availableRules.splice(index, 1);
                }
                
                attempts++;
            }

            if (!validRule) {
                alert('Could not find a valid rule that meets minimum requirements. Try resetting the cache.');
                return;
            }

            currentRule = validRule;
            addUsedRule(validRule.name);
            updateCacheInfo();
            
            filteredData = filterData(validRule, gameData);
            displayRule();
            displayEquipment();
        }

        // Display current rule
        function displayRule() {
            if (!currentRule || !filteredData) return;
            
            const ruleDisplay = document.getElementById('ruleDisplay');
            const ruleText = document.getElementById('ruleText');
            const ruleStats = document.getElementById('ruleStats');
            
            const allowedCounts = countEquipment(filteredData);
            const totalCounts = countEquipment(gameData);
            const bannedCount = totalCounts.total - allowedCounts.total;
            
            ruleDisplay.style.display = 'block';
            ruleText.textContent = `‚úÖ ALLOWED: ${currentRule.description}`;
            ruleStats.innerHTML = `
                <strong>‚úÖ Allowed:</strong> ${allowedCounts.total} items | 
                <strong>‚ùå Banned:</strong> ${bannedCount} items | 
                <strong>üìä Total:</strong> ${totalCounts.total} items<br>
                <em>Rule: Equipment ${currentRule.description.toLowerCase()}</em>
            `;
        }

        // Display equipment
        function displayEquipment() {
            if (!filteredData || !gameData) return;
            
            const container = document.getElementById('equipmentDisplay');
            let html = '';
            
            filteredData.forEach((buildData, index) => {
                const originalBuildData = gameData[index];
                
                html += `
                    <div class="class-section">
                        <div class="class-title">${buildData.build.name}</div>
                        
                        <div class="equipment-category">
                            <div class="category-title">Specializations</div>
                            <div class="equipment-list">
                                ${renderEquipmentItems(buildData.specializations, originalBuildData.specializations)}
                            </div>
                        </div>
                        
                        <div class="equipment-category">
                            <div class="category-title">Gadgets</div>
                            <div class="equipment-list">
                                ${renderEquipmentItems(buildData.gadgets, originalBuildData.gadgets)}
                            </div>
                        </div>
                        
                        <div class="equipment-category">
                            <div class="category-title">Weapons</div>
                            <div class="equipment-list">
                                ${renderEquipmentItems(buildData.weapons, originalBuildData.weapons)}
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // Render equipment items
        function renderEquipmentItems(allowedItems, allItems) {
            let html = '';
            const allowedIds = allowedItems.map(item => item.id);
            
            allItems.forEach(item => {
                const isAllowed = allowedIds.includes(item.id);
                const shouldShow = showBanned || isAllowed;
                
                if (shouldShow) {
                    const className = isAllowed ? 'equipment-allowed' : 'equipment-banned';
                    html += `<span class="equipment-item ${className}">${item.name}</span>`;
                }
            });
            
            return html;
        }

        // Toggle between showing only allowed items vs all items
        function toggleView() {
            showBanned = !showBanned;
            displayEquipment();
            
            const button = document.querySelector('.btn-secondary');
            button.textContent = showBanned ? 'üëÅÔ∏è Show Allowed Only' : 'üëÅÔ∏è Show All Items';
        }

        // Initialize the application
        loadGameData();
    </script>
</body>
</html>
